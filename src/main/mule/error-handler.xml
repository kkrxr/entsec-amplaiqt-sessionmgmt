<?xml version="1.0" encoding="UTF-8"?>
<mule
	xmlns:rxr-error-bhp="http://www.rubiconred.com/bhp/mule/extensions/error"
	xmlns:rxr-util-bhp="http://www.rubiconred.com/bhp/mule/extensions"
	xmlns:json-logger="http://www.mulesoft.org/schema/mule/json-logger"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/json-logger http://www.mulesoft.org/schema/mule/json-logger/current/mule-json-logger.xsd
http://www.rubiconred.com/bhp/mule/extensions http://www.rubiconred.com/bhp/mule/extensions/current/mule-rxr-util-bhp.xsd
http://www.rubiconred.com/bhp/mule/extensions/error http://www.rubiconred.com/bhp/mule/extensions/error/current/mule-rxr-error-bhp.xsd">
	<import doc:name="ImportErrorFlows"
		doc:id="e9c4e6f1-3daf-440b-b00a-a3d66eb812ac"
		file="entutil-coal-error-handling-client-flows.xml" />
	<rxr-error-bhp:config name="ErrorConfig"
		doc:name="RxR Error Handling (BHP) Config" />
	<error-handler name="apiExceptionHandler"
		doc:id="efd98f35-172d-4f71-9431-296f59534c8c">
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="400: Bad Request Exception"
			doc:id="c3a82c3f-9673-4b6a-9c41-1dca66955e0a"
			type="APIKIT:BAD_REQUEST">
			<rxr-error-bhp:generate-api-fault
				doc:name="Log and Generate API Fault"
				messageRoot="#[vars.MESSAGE_ROOT]" config-ref="ErrorConfig"
				errorMessage="An invalid request was sent by the caller"
				httpStatusCode="400" errorCode="101 - Default Validation" />
			<set-variable value="#[attributes.httpStatusCode]"
				doc:name="httpStatus" doc:id="5134014d-c819-4d90-991b-3113813ff3b6"
				variableName="httpStatus" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="404: Resource Not Found Exception"
			doc:id="3fe781ec-3a17-447c-9a25-e68344bd4014" type="APIKIT:NOT_FOUND">
			<rxr-error-bhp:generate-api-fault
				doc:name="Log and Generate API Fault" config-ref="ErrorConfig"
				messageRoot="#[vars.MESSAGE_ROOT]" httpStatusCode="404"
				errorMessage="The requested resource was not found in the API"
				errorCode="101 - Default Validation" />
			<set-variable value="#[attributes.httpStatusCode]"
				doc:name="httpStatus" doc:id="10d65649-cf74-4893-bc2e-0a0aa54da64d"
				variableName="httpStatus" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="405: Method Not Allowed Exception"
			doc:id="84cb7e45-9f4e-463b-9729-02b6061d2f26"
			type="APIKIT:METHOD_NOT_ALLOWED">
			<rxr-error-bhp:generate-api-fault
				doc:name="Log and Generate API Fault" httpStatusCode="405"
				messageRoot="#[vars.MESSAGE_ROOT]" config-ref="ErrorConfig"
				errorMessage="The method specified in the request is not allowed"
				errorCode="101 - Default Validation" />
			<set-variable value="#[attributes.httpStatusCode]"
				doc:name="httpStatus" doc:id="7064fca3-1f2f-45d3-b110-c33d92c6db2e"
				variableName="httpStatus" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="406: Not Acceptable Exception"
			doc:id="12962d3d-8fc7-4386-b416-b6478026f2aa"
			type="APIKIT:NOT_ACCEPTABLE">
			<rxr-error-bhp:generate-api-fault
				doc:name="Log and Generate API Fault" config-ref="ErrorConfig"
				messageRoot="#[vars.MESSAGE_ROOT]"
				errorCode="101 - Default Validation"
				errorMessage="The API cannot fulfill the client's content negotiation requirements"
				httpStatusCode="406" />
			<set-variable value="#[attributes.httpStatusCode]"
				doc:name="httpStatus" doc:id="4ad73c9c-9394-4f05-b2a5-dd5f83aa0a03"
				variableName="httpStatus" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="404: Not implemented"
			doc:id="944711fc-4372-4572-b8d6-fb62519d0005"
			type="APIKIT:NOT_IMPLEMENTED">
			<rxr-error-bhp:generate-api-fault
				doc:name="Log and Generate API Fault" config-ref="ErrorConfig"
				httpStatusCode="404" messageRoot="#[vars.MESSAGE_ROOT]"
				errorMessage="The requested resource has not been implemented yet"
				errorCode="101 - Default Validation" />
			<set-variable value="#[attributes.httpStatusCode]"
				doc:name="httpStatus" doc:id="544c0b02-e05f-4205-984e-b5e6d63d9a0d"
				variableName="httpStatus" />
		</on-error-propagate>
		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="403: Forbidden"
			doc:id="d2fce45c-5c08-45c3-a331-adac0d14858e" type="HTTP:FORBIDDEN">
			<rxr-error-bhp:generate-api-fault
				doc:name="Log and Generate API Fault" errorCode="100 - Security"
				httpStatusCode="403" config-ref="ErrorConfig"
				messageRoot="#[vars.MESSAGE_ROOT]"
				errorMessage="Access is forbidden to the requested API resource" />
			<set-variable value="#[attributes.httpStatusCode]"
				doc:name="httpStatus" doc:id="0784a827-11e6-474d-9720-0a7652e803e4"
				variableName="httpStatus" />
		</on-error-propagate>

		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="500: Internal Server Error"
			doc:id="a336ebfc-f500-4345-a693-fe2b3c627d30"
			type="HTTP:INTERNAL_SERVER_ERROR">
			<rxr-error-bhp:generate-api-fault
				doc:name="Log and Generate API Fault"
				errorCode="011 - Custom Processing" httpStatusCode="500"
				config-ref="ErrorConfig"
				messageRoot="#[error.exception.errorMessage.typedValue.Envelope.Body.Fault.detail.IntegrationError.Message]"
				errorMessage="General Error from the requested API resource" />
			<set-variable value="#[attributes.httpStatusCode]"
				doc:name="httpStatus" doc:id="2e154048-9ab0-40f0-ae75-79f3b8ced00b"
				variableName="httpStatus" />
		</on-error-propagate>

		<on-error-propagate enableNotifications="true"
			logException="true" doc:name="500: Other Exceptions"
			doc:id="22e61149-e649-4a04-8279-fa7a648a9f63" type="ANY">
			<rxr-error-bhp:generate-api-fault
				doc:name="Log and Generate API Fault" config-ref="ErrorConfig"
				messageRoot="#[vars.MESSAGE_ROOT]"
				errorMessage="The API encountered an unexpected error while trying to fulfill the request" />
			<set-variable value="#[attributes.httpStatusCode]"
				doc:name="httpStatus" doc:id="ff80e3a4-6d86-4ca0-b735-4670f272d2d4"
				variableName="httpStatus" />
		</on-error-propagate>

	</error-handler>
</mule>
